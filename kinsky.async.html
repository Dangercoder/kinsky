<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>kinsky.async documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Kinsky</span> <span class="project-version">0.1.11</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>kinsky</span></div></div></li><li class="depth-2 branch current"><a href="kinsky.async.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>async</span></div></a></li><li class="depth-2"><a href="kinsky.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="kinsky.async.html#var-channel-listener"><div class="inner"><span>channel-listener</span></div></a></li><li class="depth-1"><a href="kinsky.async.html#var-consume.21"><div class="inner"><span>consume!</span></div></a></li><li class="depth-1"><a href="kinsky.async.html#var-consumer"><div class="inner"><span>consumer</span></div></a></li><li class="depth-1"><a href="kinsky.async.html#var-default-input-buffer"><div class="inner"><span>default-input-buffer</span></div></a></li><li class="depth-1"><a href="kinsky.async.html#var-default-output-buffer"><div class="inner"><span>default-output-buffer</span></div></a></li><li class="depth-1"><a href="kinsky.async.html#var-default-timeout"><div class="inner"><span>default-timeout</span></div></a></li><li class="depth-1"><a href="kinsky.async.html#var-exception.3F"><div class="inner"><span>exception?</span></div></a></li><li class="depth-1"><a href="kinsky.async.html#var-make-consumer"><div class="inner"><span>make-consumer</span></div></a></li><li class="depth-1"><a href="kinsky.async.html#var-make-producer"><div class="inner"><span>make-producer</span></div></a></li><li class="depth-1"><a href="kinsky.async.html#var-next-poller"><div class="inner"><span>next-poller</span></div></a></li><li class="depth-1"><a href="kinsky.async.html#var-producer"><div class="inner"><span>producer</span></div></a></li><li class="depth-1"><a href="kinsky.async.html#var-record-xform"><div class="inner"><span>record-xform</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">kinsky.async</h1><div class="doc"><div class="markdown"><p>Clojure core.async support in kinsky. See <a href="https://github.com/pyr/kinsky">https://github.com/pyr/kinsky</a> for example usage.</p></div></div><div class="public anchor" id="var-channel-listener"><h3>channel-listener</h3><div class="usage"><code>(channel-listener ch)</code></div><div class="doc"><div class="markdown"><p>A rebalance-listener compatible call back which produces all events onto a channel.</p></div></div><div class="src-link"><a href="https://github.com/pyr/kinsky/blob/0.1.11/src/kinsky/async.clj#L19">view source</a></div></div><div class="public anchor" id="var-consume.21"><h3>consume!</h3><div class="usage"><code>(consume! config topics)</code><code>(consume! config kd vd topics)</code></div><div class="doc"><div class="markdown"><p>[DEPRECATED] You should now prefer the <code>consumer</code> function.</p>
<p>Build a consumer for a topic or list of topics which will produce records onto a channel.</p>
<p>Arguments config, kd and vd work as for kinsky.client/consumer Argument topics is as for kinsky.client/subscribe</p>
<p>Yields a vector of three values: [consumer records ctl]</p>
<ul>
  <li>consumer is a consumer driver, see  <a href="kinsky.client.html#var-consumer">kinsky.client/consumer</a></li>
  <li>records is a channel of records, see  <a href="kinsky.client.html##var-record-xform">kinsky.client/record-xform</a>  for content description</li>
  <li>ctl is a channel of control messages, as given by the rebalance  listener or exception if they were produced by the transducer.</li>
</ul></div></div><div class="src-link"><a href="https://github.com/pyr/kinsky/blob/0.1.11/src/kinsky/async.clj#L55">view source</a></div></div><div class="public anchor" id="var-consumer"><h3>consumer</h3><div class="usage"><code>(consumer config)</code><code>(consumer config kd vd)</code></div><div class="doc"><div class="markdown"><p>Build an async consumer. Yields a vector of record and control channels.</p>
<p>The config map must be a valid consumer configuration map and may contain the following additional keys:</p>
<ul>
  <li><code>:input-buffer</code>: Maximum backlog of control channel messages.</li>
  <li><code>:output-buffer</code>: Maximum queued consumed messages.</li>
  <li><code>:timeout</code>: Poll interval</li>
</ul>
<p>The resulting control channel is used to interact with the consumer driver and expects map payloads, whose operation is determined by their <code>:op</code> key. The following commands are handled:</p>
<ul>
  <li><code>:subscribe</code>: <code>{:op :subscribe :topic &quot;foo&quot;}</code> subscribe to a topic.</li>
  <li><code>:unsubscribe</code>: <code>{:op :unsubscribe}</code>, unsubscribe from all topics.</li>
  <li><code>:partitions-for</code>: <code>{:op :partitions-for :topic &quot;foo&quot;}</code>, yield partition  info for the given topic. If a <code>:response</code> key is  present, produce the response there instead of on  the record channel.</li>
  <li><code>commit</code>: <code>{:op :commit}</code> commit offsets, an optional <code>:topic-offsets</code> key  may be present for specific offset committing.</li>
  <li><code>:pause</code>: <code>{:op :pause}</code> pause consumption.</li>
  <li><code>:resume</code>: <code>{:op :resume}</code> resume consumption.</li>
  <li><code>:calllback</code>: <code>{:op :callback :callback (fn [d ch])}</code> Execute a function  of 2 arguments, the consumer driver and output channel, on a woken up  driver.</li>
  <li><code>:stop</code>: <code>{:op :stop}</code> stop and close consumer. records an control message and one to interact with the consumer driver.</li>
</ul>
<p>The resulting output channel will emit payloads with as maps containing a <code>:type</code> key where <code>:type</code> may be:</p>
<ul>
  <li><code>:record</code>: A consumed record.</li>
  <li><code>:exception</code>: An exception raised</li>
  <li><code>:rebalance</code>: A rebalance event.</li>
  <li><code>:eof</code>: The end of this stream.</li>
  <li><code>:partitions</code>: The result of a <code>:partitions-for</code> operation.</li>
  <li><code>:woken-up</code>: A notification that the consumer was woken up.</li>
</ul></div></div><div class="src-link"><a href="https://github.com/pyr/kinsky/blob/0.1.11/src/kinsky/async.clj#L103">view source</a></div></div><div class="public anchor" id="var-default-input-buffer"><h3>default-input-buffer</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Default amount of messages buffered on control channels.</p></div></div><div class="src-link"><a href="https://github.com/pyr/kinsky/blob/0.1.11/src/kinsky/async.clj#L7">view source</a></div></div><div class="public anchor" id="var-default-output-buffer"><h3>default-output-buffer</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Default amount of messages buffered on the record channel.</p></div></div><div class="src-link"><a href="https://github.com/pyr/kinsky/blob/0.1.11/src/kinsky/async.clj#L11">view source</a></div></div><div class="public anchor" id="var-default-timeout"><h3>default-timeout</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Default timeout, by default we poll at 100ms intervals.</p></div></div><div class="src-link"><a href="https://github.com/pyr/kinsky/blob/0.1.11/src/kinsky/async.clj#L15">view source</a></div></div><div class="public anchor" id="var-exception.3F"><h3>exception?</h3><div class="usage"><code>(exception? e)</code></div><div class="doc"><div class="markdown"><p>Test if a value is a subclass of Exception</p></div></div><div class="src-link"><a href="https://github.com/pyr/kinsky/blob/0.1.11/src/kinsky/async.clj#L39">view source</a></div></div><div class="public anchor" id="var-make-consumer"><h3>make-consumer</h3><div class="usage"><code>(make-consumer config stop kd vd)</code></div><div class="doc"><div class="markdown"><p>Build a consumer, with or without deserializers</p></div></div><div class="src-link"><a href="https://github.com/pyr/kinsky/blob/0.1.11/src/kinsky/async.clj#L44">view source</a></div></div><div class="public anchor" id="var-make-producer"><h3>make-producer</h3><div class="usage"><code>(make-producer config ks vs)</code></div><div class="doc"><div class="markdown"><p>Build a producer, with or without serializers</p></div></div><div class="src-link"><a href="https://github.com/pyr/kinsky/blob/0.1.11/src/kinsky/async.clj#L211">view source</a></div></div><div class="public anchor" id="var-next-poller"><h3>next-poller</h3><div class="usage"><code>(next-poller consumer timeout)</code></div><div class="doc"><div class="markdown"><p>Poll for next messages, catching exceptions and yielding them.</p></div></div><div class="src-link"><a href="https://github.com/pyr/kinsky/blob/0.1.11/src/kinsky/async.clj#L26">view source</a></div></div><div class="public anchor" id="var-producer"><h3>producer</h3><div class="usage"><code>(producer config)</code><code>(producer config ks)</code><code>(producer config ks vs)</code></div><div class="doc"><div class="markdown"><p>Build a producer, reading records to send from a channel.</p>
<p>Arguments config ks and vs work as for kinsky.client/producer.</p>
<p>Yields a vector of three values: [producer records ctl]</p>
<ul>
  <li>producer is a producer driver, see:  <a href="kinsky.client.html#var-producer">kinsky.client/producer</a></li>
  <li>records expects records to produce, see:  <a href="kinsky.client.html#var-send.21">kinsky.client/send!</a></li>
  <li>ctl is a channel which will receive any exception received  during production.</li>
</ul></div></div><div class="src-link"><a href="https://github.com/pyr/kinsky/blob/0.1.11/src/kinsky/async.clj#L218">view source</a></div></div><div class="public anchor" id="var-record-xform"><h3>record-xform</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Rely on the standard transducer but indicate that this is a record.</p></div></div><div class="src-link"><a href="https://github.com/pyr/kinsky/blob/0.1.11/src/kinsky/async.clj#L98">view source</a></div></div></div></body></html>